===========================================================================
< Hot Soup Processor (HSP) 拡張プラグイン >
 コールバック関数実装プラグイン hscallbk.dll for HSP3

                                         ver 1.0   2005.09.13  by ちょくと
===========================================================================


■ はじめに

   hscallbk.dll はHSP3でWin32 APIのためのコールバック関数を扱うことが
   できるようにするための拡張プラグインです。

   本来HSP3ではAPI用のコールバック関数を扱う機能が実装される予定でしたが
   その機能が先送りされたため、代替機能として公開してみました。


■ 使用可能な開発環境

   HSP (Hot Soup Processor) 3.0a 以降


■ 動作可能な実行環境

   Microsoft Windows 98 / Me / NT 4.0 / 2000 / XP


■ インストール

   アーカイブを解凍すると、以下のファイルがあります。

   ・hscallbk.dll
   ・hscallbk.as
   ・readme.txt (このドキュメント)
   ・サンプルスクリプト (sampleフォルダ)

   これらのうち hscallbk.dll をHSPがインストールされているフォルダの中に、
   hscallbk.as を "common" フォルダの中にコピーしてください。


■ 使用方法

   スクリプトに次のように記述してモジュールをインクルードします。

     #include "hscallbk.as"

   これによりスクリプト中で setcallbk 命令および callbkarg 関数を使用する
   ことができるようになります。

   * setcallbk p1, p2, *p3

      新しいコールバック関数を登録し、コールバック型の変数を作成します。

        p1 : コールバック型として初期化する変数名
        p2 : #func で登録したコールバック関数の名前
        p3 : コールバック時にジャンプするサブルーチンラベル

      この拡張プラグインでは、コールバック関数の引数の型の情報を得るのに
      #func で登録された関数情報を使用します。あらかじめコールバック関数
      の情報を登録しておく必要があります。このときDLL名や関数名は必要ない
      ため、ダミーとして空文字列を指定してかまいません。

      例)
        #uselib ""                          // DLL 名を空文字列 "" に
        #func EnumWindowProc "" int,int     // 関数名を空文字列 "" に

      現在は int, double, str, comobj 型の引数のみをサポートしています。

      コールバック関数を管理する新しい変数型としてコールバック型の変数が
      作成されます。次のように書くと変数 Proc がコールバック型になります。

      例)
	setcallbk Proc, EnumWindowProc, *OnEnumWindowProc

      コールバック型変数からコールバック関数のアドレスを取得するためには
      varptr 関数を使用することができます。varptr(Proc) とのように書くと
      変数 Proc で管理されるコールバック関数のアドレスが返されます。
      例として、EnumWindow 関数の呼び出しは次のように書くことができます。

      例)
        EnumWindow varptr(Proc), 0

      Windowsからコールバック関数が呼び出されると、setcallbk で指定された
      ラベルにサブルーチンジャンプします。ジャンプ先では callbkarg 関数で
      引数情報を取得することができます。

   * callbkarg( p1 )

      コールバック関数に渡された引数を取得します。

        p1 : 引数のインデックス（0〜）

      callbkarg 関数はコールバック処理中のみ使用可能です。それ以外の時は
      エラーになります。callbkarg 関数が返すデータは #func で登録されて
      いる引数情報に応じて変化します。


      詳細は同梱されているサンプルスクリプトを参照してください。


■ 著作権、免責など

   このアーカイブに含まれる拡張プラグインやプログラムやドキュメントは作者
   である ちょくと がその著作権を保有しています。

   この拡張プラグインはフリーウェアです。商用・非商用を問わず、自由に使用
   することができます。

   このソフトウェアを使用することによって生じた、いかなる損害についても、
   作者は一切関与せず、責任を追わないものとさせていただきます。
   このソフトウェアを使用する場合は、各使用者の責任の元で行ってください。
   これに応じられない場合には、このソフトウェアを使用しないでください。


■ 最新版のダウンロード・サポート・連絡先

   この拡張プラグインのサポートは「ちょくとのページ」にて行なっています。
   最新版は当サイトのダウンロードのページにて配布しております。

   不具合等を発見された場合には、当サイトの掲示板に書き込んでいただくか、
   メールでお知らせいただければ、できる限り早急に対応致します。

     ちょくとのページ        : http://yokohama.cool.ne.jp/chokuto/
     ちょくとのページ 掲示板 : http://6919.teacup.com/chokuto/bbs/
     メールアドレス          : chokutto@yahoo.co.jp


■ 謝辞

   Hot Soup Processor という非常に高機能なプログラミング言語をフリーで提
   供してくださっている Onion Software の おにたま様に感謝致します。


■ 更新履歴 (上に行くほど新しい)

  ○1.0 (2005.09.13)

    ・正式版として公開
    ・HSP 3.0a に対応

  ○バージョン番号なし（テスト版）(2005.06.29)

    ・テスト版として公開

