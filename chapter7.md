# Gitのコミット

前回のギトギット！ (♬)

0. GitHub のアカウントを作った！
0. GitHub にリポジトリを作った！
0. GitHub リポジトリに git push してバックアップを作った！

[序文](README.md) で触れた内容は前回で完遂し、みなさんは git をバックアップツールとして使いこなせるようになりました。
さて、今回から **第2部** です。Gitの底力はまだまだこんなもんじゃないですからね！

いままで git add と git commit については、あまり詳しく話していませんでした。
今回はこれを詳しく解説します。

## コミットオブジェクト

いままで直接は説明しませんでしたが、git commit を行うと、「前回の git commit より後にした変更」がリポジトリに記録されます。
このときの「記録」のことを、まとめて1個の **コミットオブジェクト**(commit object) と呼びます。
(単にコミットと略すのが一般的です。)

コミットオブジェクトには、以下のような情報が記録されています。

* コミットメッセージ
* コミットした人のユーザ名とメアド
* 変更後のファイル
* 親コミットオブジェクトたちのハッシュ値
* (他にもありますが、省略)

上3つはみなさんもご存知でしょう。
気になるのは「親コミットオブジェクト」ですね。

コミットオブジェクトの間には親子関係があります。
[第5回 Gitの記録](chapter5.md) で使った git log の結果を引用して説明します。

```
$ git log --oneline
3456001 7 回目の更新  [= HEAD]
  ↓
1720f58 6 回目の更新
  ↓
99bd126 5 回目の更新
  ↓
96a691b 4 回目の更新
  ↓
3a7f2d9 3 回目の更新
  ↓
70e529a 2 回目の更新
  ↓
dfb29ca 1 回目の更新  [親なしコミット]
```

ここでの矢印は、「子 → 親」という関係を表しています。
git log は、最新のコミットオブジェクト 3456001 (= HEAD) から始めて、親へ親へと辿っていくことで、コミットオブジェクト (のハッシュ値とメッセージ) を列挙していたのです。

そう考えると、コミットオブジェクトというのは、「1回の変更」と言いましたが、 **1つのバージョンを表している** とみなすことも可能です。

## HEADの定義の更新
さて、 [第5回](chapter5.md) で HEAD を以下のように説明しましたが、(意図的な)誤りです。謝ります。

> HEAD とは「最後に git commit された変更」を表しているものです。

いままで私が説明したコマンドだけを使っているかぎり、上の理解でもある意味正しいのですが、これから次のステップに進むため、もう少し正確な説明を与えます。

* HEAD とは、作業ディレクトリが元にしているコミットオブジェクトを指し示す名前である。

よく分かりませんね。
とりあえず関係代名詞があるので、2つの文に分けてみます。

* HEAD とは、あるコミットオブジェクトを指し示す名前である。
* 作業ディレクトリは、そのコミットオブジェクトを元にしている。

コミットオブジェクトが「バージョン」を表すと前節でいいましたが、ここでそのように言い換えてみましょう。

* HEAD とは、あるバージョンを指し示す名前である。
* 作業ディレクトリは、そのバージョンを元にしている。

分かりやすくなってきました。
ここでいう「あるバージョン」は、今までは常に「最新のバージョン」でした。
git checkout を使うことで、別のバージョンを指すようにすることができます。

適当なリポジトリで bash を開き、作業ディレクトリをクリーンにしてから (つまり、git commit していない変更がないようにしてから)、以下のコマンドを実行してみてください。

```
$ git checkout HEAD~
```

すると、例えば以下のような表示になります。
長い英文が出てきますが、これは git からの親切な忠告です。無視します。

```
$ git co HEAD~
Note: checking out 'HEAD~'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b <new-branch-name>

HEAD is now at 3456001... 7 回目の更新
```




## 参考文献
* [もうGitは怖くない： 自信を持って使いたいあなたへ - 檜山正幸のキマイラ飼育記](http://d.hatena.ne.jp/m-hiyama/20150928/1443397382) (2016年3月18日閲覧)
  * コミットグラフに関する、日本語で読めるかなり詳しい解説。
