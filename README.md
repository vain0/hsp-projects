# deflister (definition lister)
## 概要
HSP3スクリプトに含まれる定義を一覧にするソフトです。
HSP3スクリプトエディタに、外部ツールとして登録することで、ラベル参照と同じ感覚で定義を参照することが可能になります。
ラベルも拾うため、ラベル参照の上位互換となっています。

## 使い方
### 外部ツールとして使う場合
HSP3標準スクリプトエディタ(hsed3)の外部ツールとして登録する場合、コマンドライン引数に「hsed」を与えてください。
コマンドラインがない場合は、通常実行と見なし、hsed を無視します。

### コマンドライン
3通りあります。

* hsed
 * hsed3 の外部ツールとして実行します。
* filename
 * ファイル名を指定して開きます。
* なし
 * 対象スクリプトを、ダイアログで選択します。これが通常実行です。

### 拾ってくる定義
プリプロセッサ命令とラベルです。ラベルは、定義の部分のみ拾います。

次のプリプロセッサ命令の次にある識別子を拾います。

* 命令     : deffunc,   modfunc,  func(Dll), comfunc(COM)
* 関数     : defcfunc, modcfunc, cfunc(Dll)
* マクロ   : define
* 定数     : const, enum
* コマンド : cmd
* interface: usecom
  
次の識別子を無視します。

* global, local, ctype, double

### 種類カラム
定義されている識別子の種類です。命令、関数、マクロ、定数、ラベルの5パターンがあります。
オプションとして、以下の文字列が付属している可能性があります。

* C: ctype  ( 関数形式マクロ )
* M: module ( #modfunc や #modcfunc )

### 範囲カラム
これは、定義される空間の名前になります。 空間は、識別子の後ろに `@` をつけるか、`#module` 〜 `#global` の内部で定義することによって定まります。`@` に続く空間名が省略されている場合は、グローバル領域での定義となります。

以下の場合、範囲カラムには空間名の代わりに、特別な文字列が入ります。

* グローバル領域:
 * `global`
* すべての領域:
 * `*`
* 無名モジュール:
 * ``m? [unique]``
* local 指定:
 * ``... [local]``

すべての領域とは、`#deffunc` や、`global` 付きの `#define` などです。すべての領域で永続的に使用できるため、これらには範囲がありません。
`#deffunc` などで local 指定をした場合、同じモジュール空間からも `@...` が必要になるので、`[local]` と表示し、他の命令と区別されます。

### ファイルカラム
定義収集対象のファイル名になります。スクリプトエディタで編集中のファイルは、`[hsedtmp.hsp]` というファイル名になります。

## 権利
誰でも、パッケージに含まれるモノはすべて、改変の有無、一部・全部にかかわらず自由に使用、流用、配布することができます。

## 関連URL
* プログラ広場 <http://prograpark.ninja-web.net/>
 * ご意見、ご要望、バグ報告、質問などはここの掲示板へお願いします。

* HSP本家サイト <http://hsp.tv/>

## 更新履歴
#### 2009 11/01 (Sun)
* プリプロセス行が「\」で改行回避している場合、行数が進まなかったバグを修正。
* 複数行の文字列やコメントが、余計に 1 行分進んでいたバグを修正。
* バージョン1.16としてリリース。

#### 2009 08/20 (Thu)
* #comfunc, #usecom を拾うように変更。リリースせず。

#### 2009 08/05 (Wed)
* 複数行文字列定数 {"..."} が複数行にわたる場合、それの行数を数えていないために、それ以降の定義の行番号がずれるバグを修正。
 * 致命的ではないのでリリースせず。

#### 2009 08/04 (Tue)
* hsedsdk に勝手に追加していた部分を Mo/hsedutil.as に移動させたことで発生していたバグを修正。
 * _HSED_* の定数が未定義変数( int 0 )になってた。
 * hsed_capture で変更された hIF@hspsdk を参照できなかった。
  * ( hIF@hsedutil を参照していた )
* HPM_getToken を使って解析していたところを、HPM_split を使用するように変更。
 * けっこう遅くなった。……どうにか最適化しないと。
* バージョン1.15としてリリース。

#### 2009 07/29 (Wed)
* #modcfunc を拾えるバージョンをリリース。
 * ついでに modvar ハックを #modcfunc に修整。
* なぜか対応していなかった #func、#cfunc、#cmd に対応。
* エディットボックスをスクロールするとき、定義より何行前を基準にするかを
 * ini ファイルで指定できるようにした。( Editbox/cntShowLineBefore )
* バージョン1.14としてリリース。

#### 2009 07/12 (Sun)
* #modcfunc が拾えていなかったバグを修正 (無害ではあるが)。

#### 2009 05/11(Mon)
* 設定ファイルを作るようにした。以下の設定がある。
 * include先を探すかどうか
 * カスタムドローするかどうか
 * ウィンドウの位置
 * コントロールのフォント
* 開いたファイルでない宣言をLvで選択したときに、そのファイルを読み込んで、Editbox で周囲を見られるようにした。
 * 若干遅いが……気にしない！ (既に十分遅い)

#### 2008 12/08(Mon)
* double を無視するように変更。( #const )

#### 2008 11/24(Mon)
前日から引き続き……

* バージョン1.12をリリース。

#### 2008 11/23(Sun)
* 実行してもカレントディレクトリを変更しないように修整。
* common のパスを hsed3 のパスから計算するように変更。
* 定義をスクリプトではなくファイルから取り出すように変更。
 * hsed の場合、必ず一時ファイルを作成する。
* TookDefinition 命令や deflist〜系の配列を、
 * モジュールクラスで扱うように修整。見やすくなった。
* hsed のプロセスメモリを操作するようになったため、3.1版以外での動作を保証できなくなった。
* Ｄ＆Ｄの時、ClipCursor関数でマウスカーソルの移動範囲を制限するように変更。
 * これで、端っこでぴくぴくすることがなくなった。
 * → onerror を受付、bDragging が真なら移動範囲を解放する。
* 無名モジュール空間を m? [unique] に変更。[local] に合わせてみた。
* 無条件でファイルカラムを追加。
 * 前は、include先も対象にするときだけだった。
 * → 簡略化のため。
* ファイルを読み込むときに、検索パスに追加するよう修整。
 * → かなり遅くなる。なんとかなるのか……？

#### 2008 11/22(Sat)
* Mutex によって二重起動を防止。
 * 埋もれていても、二重起動することで最前面に戻せるようになった。
* バージョン1.11をリリース。

#### 2008 11/20(Thu)
* 無名モジュール空間が (n)unique になるように修整。
 * 以前は空だった。
* #deffunc #modfunc #defcfunc #modcfunc を、デフォルトで永続 global 指定にした。( @ や local がない場合 )
* local はただの global 外しではないので、範囲に[local] を付加するように修整。

#### 2008 11/19(Wed)
* リストボックスではなく、リストビューに変更。
 * 「行番号、識別子、種類、範囲」を拾う。
 * カスタムドローを検討。
* 一行一行切り出す方式から、HPMで構文解析を行うように変更。
 * ラベルも拾うため。
* ↑により、行番号の取得方法を変更。いちいち関数を呼び出して行番号を求めるように修整。
* ↑により、非常に低速化したので、indexもリストにするように修整。
 * まだましな速度に落ち着いた。
* ランタイムを hsp3mt に変更。高速になる。( ファイルサイズは増加 )
 * テストでは、hsp3 の1.5倍速だった。
* 記号 @ を処理するように修整。
* EnterキーやＷクリックでジャンプ出来るように修整。(LVN_ITEMACTIVATE)
* バージョン 1.10 が完成、公開。

* リストビューをカスタムドローにしてみた。
 * 見やすくなった気はしない。

#### 2008 11/18(Tue)
* 初期バージョンが完成。公開。( HSPTV!掲示板で宣伝 )
